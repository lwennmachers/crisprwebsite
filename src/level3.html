<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Level 3: Ethical Dilemmas of CRISPR</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: rgb(245, 245, 245);
        margin: 0;
        padding: 0;
      }
      header {
        text-align: center;
        background: linear-gradient(
          to right,
          rgb(244, 67, 54),
          rgb(211, 47, 47)
        );
        color: white;
        padding: 40px;
        border-radius: 0 0 10px 10px;
        margin-bottom: 20px;
        box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.2);
      }
      main {
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      h2 {
        color: rgb(244, 67, 54);
        font-size: 1.5rem;
        margin-bottom: 10px;
      }
      p {
        line-height: 1.6;
        color: rgb(80, 80, 80);
      }
      .word-search {
        margin-top: 30px;
        padding: 20px;
        border: 1px solid rgb(221, 221, 221);
        border-radius: 10px;
        background-color: rgb(250, 250, 250);
        text-align: center;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 5px;
        justify-content: center;
        margin: 10px auto;
        max-width: 240px;
      }
      .cell {
        width: 30px;
        height: 30px;
        text-align: center;
        font-weight: bold;
        background-color: rgb(200, 230, 201);
        border: 1px solid rgb(76, 175, 80);
        cursor: pointer;
        user-select: none; /* Prevent text selection highlight */
      }
      .selected {
        background-color: rgb(255, 193, 7);
      }
      button {
        margin-top: 20px;
        background-color: rgb(255, 87, 34);
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      button:hover {
        background-color: rgb(230, 74, 25);
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Level 3: Ethical Dilemmas of CRISPR</h1>
    </header>
    <main>
      <section>
        <h2>Understanding the Ethical Concerns</h2>
        <p>
          CRISPR technology presents many ethical questions. Should we edit
          human embryos? Who decides what genes should be changed? Could genetic
          modifications lead to unintended consequences? These are critical
          issues scientists, policymakers, and society must consider.
        </p>
      </section>

      <section class="word-search">
        <h3>Word Bank</h3>
        <p>
          <strong>Find these words:</strong> ETHICS, CONSENT, RISK, EDITING,
          EMBRYO
        </p>
        <h2>Word Search: Ethical Dilemmas of CRISPR</h2>
        <p>
          Find and select letters that form these words. Words can be
          <strong>horizontal, vertical, diagonal, and even backwards</strong>!
        </p>
        <div class="grid" id="wordSearchGrid"></div>
        <button onclick="checkWordSearch()">Check Answers</button>
        <p id="wordSearchFeedback" class="hidden"></p>
      </section>
      <a href="index.html">Back to Homepage</a>
    </main>

    <script>
      const words = ["ETHICS", "CONSENT", "RISK", "EDITING", "EMBRYO"];
      const gridSize = 8;
      let grid = Array(gridSize)
        .fill(null)
        .map(() => Array(gridSize).fill(" "));
      let cellElements = []; // We'll store DOM references to each grid cell

      // Directions [rowIncrement, colIncrement]
      const directions = [
        [1, 0], // horizontally forward
        [0, 1], // vertically downward
        [1, 1], // diagonal down-right
        [-1, 1], // diagonal up-right
        [1, -1], // diagonal down-left
        [-1, -1], // diagonal up-left
        [0, -1], // vertically upward
        [-1, 0], // horizontally backward
      ];

      // 1) Place words in the grid
      function placeWord(word) {
        let placed = false;
        let attempts = 0;
        while (!placed && attempts < 100) {
          attempts++;
          let row = Math.floor(Math.random() * gridSize);
          let col = Math.floor(Math.random() * gridSize);
          let direction =
            directions[Math.floor(Math.random() * directions.length)];
          let fits = true;

          // Check each character's position
          for (let i = 0; i < word.length; i++) {
            let newRow = row + i * direction[0];
            let newCol = col + i * direction[1];
            if (
              newRow < 0 ||
              newRow >= gridSize ||
              newCol < 0 ||
              newCol >= gridSize ||
              grid[newRow][newCol] !== " "
            ) {
              fits = false;
              break;
            }
          }
          // If fits, place it
          if (fits) {
            for (let i = 0; i < word.length; i++) {
              let newRow = row + i * direction[0];
              let newCol = col + i * direction[1];
              grid[newRow][newCol] = word[i];
            }
            placed = true;
          }
        }
      }

      words.forEach((w) => placeWord(w));

      // 2) Fill leftover spaces with random letters
      for (let r = 0; r < gridSize; r++) {
        for (let c = 0; c < gridSize; c++) {
          if (grid[r][c] === " ") {
            grid[r][c] = String.fromCharCode(
              65 + Math.floor(Math.random() * 26)
            );
          }
        }
      }

      // 3) Render the grid
      const wordSearchGrid = document.getElementById("wordSearchGrid");
      for (let r = 0; r < gridSize; r++) {
        cellElements[r] = [];
        for (let c = 0; c < gridSize; c++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.textContent = grid[r][c];
          cell.dataset.row = r;
          cell.dataset.col = c;
          // Click to select/deselect
          cell.addEventListener("click", () => {
            cell.classList.toggle("selected");
          });
          wordSearchGrid.appendChild(cell);
          cellElements[r][c] = cell;
        }
      }

      // 4) Check if user found all words
      function checkWordSearch() {
        let foundCount = 0;
        for (let w of words) {
          if (isWordFound(w)) foundCount++;
        }
        const feedback = document.getElementById("wordSearchFeedback");
        if (foundCount === words.length) {
          feedback.textContent = "Excellent! You found all words!";
        } else {
          feedback.textContent = `You found ${foundCount} of ${words.length} words. Keep trying!`;
        }
        feedback.classList.remove("hidden");
      }

      // Attempt to see if word w is fully selected in the grid
      function isWordFound(w) {
        // We'll check each cell to see if it's a match for first letter
        // Then we'll see if the contiguous cells in any direction match all letters
        // in correct order or reversed.
        const reversed = w.split("").reverse().join("");
        for (let r = 0; r < gridSize; r++) {
          for (let c = 0; c < gridSize; c++) {
            if (grid[r][c] === w[0] || grid[r][c] === reversed[0]) {
              // Try each direction
              for (let d of directions) {
                if (checkLine(r, c, d[0], d[1], w)) return true;
                if (checkLine(r, c, d[0], d[1], reversed)) return true;
              }
            }
          }
        }
        return false;
      }

      // Check if letters in a line match 'str' and are selected
      function checkLine(startR, startC, dr, dc, str) {
        let positions = [];
        // gather positions
        for (let i = 0; i < str.length; i++) {
          let rr = startR + i * dr;
          let cc = startC + i * dc;
          // bounds check
          if (rr < 0 || rr >= gridSize || cc < 0 || cc >= gridSize)
            return false;
          // letter match?
          if (grid[rr][cc] !== str[i]) return false;
          positions.push([rr, cc]);
        }
        // now check if all positions are selected
        for (let [pr, pc] of positions) {
          if (!cellElements[pr][pc].classList.contains("selected")) {
            return false;
          }
        }
        return true;
      }
    </script>
  </body>
</html>
